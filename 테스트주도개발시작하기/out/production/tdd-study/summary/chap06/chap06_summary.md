# 테스트 코드의 구성

- 내가 자주 사용한 given, when, then에 대해 설명이 되어있다.
- 외부 상황이나 결과를 통해 직접 테스트 하기보단 '대역'을 사용하자라는 설명이 되어있다. (대역이란 모킹을 이용하는 것이겠다.)

## 기능에서의 상황
- 기능은 당연히 상황에 따라 다르게 동작함.
  - given에서 주어진 값이 다르다면 실행 결과는 다르다는 의미이다.
- 다양한 상황을 생각 해야한다.
  - 다양한 상황을 생각하지 못하면 내가 만든 코드는 버그로 뒤덮일 것이다.

## 테스트 코드의 구성요소
- 상황, 실행, 결과 = given, when, then
- 위 구성요소들을 이용해 테스트를 작성하면 테스트 내용을 이해하기 쉽다.

> 무조건 위 구성요소에 맞게 테스트를 하려하지마라, 하는 건 좋으나, 위 구성요소 모두를 사용한 테스트가 불가능한 상황도 있다. 이를테면, 회원가입시 중복 아이디로 회원가입 실패와 같은 기능에 대한 테스트는, 실행과 결과가 한곳에 뭉쳐있다.(=when, then이 한곳에 뭉쳐있다.)
```java
assertThrows(MemberDuplicateException.class, () -> MemberService.signup(email));
//실행인 signup, 과 결과 가 한 문장에 존재함
```

## 외부상태가 테스트 결과에 영향을 주지 않게 하기
- 테스트는 계속해서 실행해야 한다. 그렇기에 외부 상황에 따라 테스트 결과가 매번 달라지면 안된다. (테스트의 신뢰가 떨어진다.)
  - DB에 접근해서 테스트 하는경우 '상황'부분에 DB에 필요한 데이터를 세팅을 하지 않거나, '결과'가 끝난뒤 롤백을 시키지 않으면 각 테스트들은 외부상태인 DB 에 영향이 가므로 매번 테스트 실행 결과가 달라진다..
- 테스트 마다 외부 상태를 원래 상태로 초기화 해줘야한다.!! 필요하면 상황에서 세팅을 하거나!

## 외부상태와 테스트 어려움
- 사실 외부 상태를 이용한 기능에 대해서, 테스트를 할땐, 어려움이 많다. 테스트 마다 외부 상태에 접근하거나, 실제로 해당 상황을 테스트에서 그려내기 위해선 현실적으로 불가능할때도 있다.
- 그래서 **대역** 을 이용해야한다.
  - 대역이란? 외부 상태의 대체자이다. 나는 모킹을 통해 가짜를 주입받아 테스트하곤 했었다. 

## 느낀점
- 상황, 실행, 결과의 테스트 구성요소는 평소에도 자주 사용했기에 당연하다 생각하며 읽었다.
- 테스트는 항상 같은 결과를 도출해야 하므로 외부 상태에 따라 결과가 달라지면 안된다.
  1. 외부상태를 사용하는 테스트는 테스트 마다 초기화해야한다.
  2. 실제 외부상태를 사용하지 않고 **대역**을 사용하자.
- 모킹을 실제로도 많이 사용하고 고민도 많이 하였는데, 외부 상태에 따른 테스트에 대해 **대역**을 이용하란 문장을 보곤 공감이 많이 갔다. 실제로 외부 상태를 이용하는 테스트는 어려움이 많다는 건 나도 테스트를 하며 많이 느꼈기 때문이다.

> 다음 챕터에선 대역을 어떻게 사용하나?, 대역이 뭔가? 등에 대해 보다 깊이 공부할 건데 평소에도 궁금했던 부분이기에 기대가된다.

